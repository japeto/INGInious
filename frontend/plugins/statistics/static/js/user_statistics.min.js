const CsvConverter=function(){function t(t){this.data=t}return t.prototype.downloadCsv=function(){const t="data:text/csv;charset=utf-8,"+Papa.unparse(this.data),e=encodeURI(t),s=document.createElement("a");s.setAttribute("href",e),s.setAttribute("download","export.csv"),document.body.appendChild(s),s.click(),s.remove()},t}(),Statistic=function(){function t(){this._cachedPromise=null}return t.prototype._fetchAndCacheData=function(){return null==this._cachedPromise&&(this._cachedPromise=this._fetchData()),this._cachedPromise},t.prototype.plotAsync=function(){const t=this;this._fetchAndCacheData().then(function(e){t._plotData(e)})},t.prototype._fetchCsvData=function(){return this._fetchAndCacheData()},t.prototype.downloadCsvAsync=function(){this._fetchCsvData().then(function(t){new CsvConverter(t).downloadCsv()})},t.prototype._plotData=function(t){throw"Not implemented"},t.prototype._fetchData=function(){throw"Not implemented"},t}();function createSubmissionLink(t){return _.template("/submission/${ submissionId }")({submissionId:t})}function generateVerdictSubmissionTable(t,e){const s=$("#"+t);s.html("<thead><tr><th>Username</th><th>Grade</th><th>Status</th><th>Summary result</th><th>Submitted on</th><th>Submission</th></tr></thead>");const i=$("<tbody/>");for(let t=0;t<e.length;++t){const s=$("<tr/>"),a=e[t],o=[a.username,a.grade,a.status||"-",a.summary_result||"-",a.submitted_on||"-"];for(let t=0;t<o.length;++t){const e=$("<td/>");e.text(o[t]),s.append(e)}const r=$("<td/>");if(a.id){const t=$("<a>",{text:a.id,href:createSubmissionLink(a.id)});r.append(t)}else r.text("No submission available");s.append(r),i.append(s)}s.append(i)}function generateSubmissionTable(t,e){const s=$("#"+t);s.html("<thead><tr><th>Username</th><th>Grade</th><th>Status</th><th>Summary result</th><th>Submitted on</th><th>Submission</th></tr></thead>");const i=$("<tbody/>");for(let t=0;t<e.length;++t){const s=$("<tr/>"),a=e[t],o=a.submission||{},r=[a.username,a.grade,o.status||"-",o.summary_result||"-",o.submitted_on||"-"];for(let t=0;t<r.length;++t){const e=$("<td/>");e.text(r[t]),s.append(e)}const n=$("<td/>");if(o.id){const t=$("<a>",{text:o.id,href:createSubmissionLink(o.id)});n.append(t)}else n.text("No submission available");s.append(n),i.append(s)}s.append(i)}function createAlertHtml(t,e){return'<div class="alert '+t+' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+e+"</div>"}const UserStatistics={colors:{COMPILATION_ERROR:"rgb(236,199,6)",TIME_LIMIT_EXCEEDED:"rgb(50,120,202)",MEMORY_LIMIT_EXCEEDED:"rgb(119,92,133)",RUNTIME_ERROR:"rgb(2,164,174)",WRONG_ANSWER:"rgb(227,79,54)",OUTPUT_LIMIT_EXCEEDED:"rgb(137,139,37)",GRADING_RUNTIME_ERROR:"rgb(139,62,0)",ACCEPTED:"rgb(35,181,100)"}},UserTrialsAndBestGradeStatistic=function(){function t(t){this.course_id=t,this.div_id="tries_per_task",this.RESOURCE_URL="/api/stats/student/trials_and_best_grade"}return t.prototype=Object.create(Statistic.prototype),t.prototype._fetchData=function(){return $.getJSON(this.RESOURCE_URL,{course_id:this.course_id})},t.prototype._plotData=function(t){const e=this._getRatio(t),s={},i=Object.keys(UserStatistics.colors);for(let t=0;t<i.length;t++)s[i[t]]={mode:"markers",name:i[t],marker:{color:UserStatistics.colors[i[t]],sizemode:"area",sizeref:e,size:[]},text:[],x:[],y:[]};for(let e=0;e<t.length;e++){const i=t[e].result;s[i].x.push(t[e].task_name),s[i].y.push(t[e].grade),s[i].text.push(t[e].tried+" submissions"),s[i].marker.size.push(t[e].tried)}const a=[];for(let t=0;t<i.length;t++)a.push(s[i[t]]);Plotly.purge(this.div_id),Plotly.plot(this.div_id,a,{xaxis:{title:"Task"},yaxis:{title:"Grade",range:[-10,110]},margin:{t:20},hovermode:"closest",legend:{font:{size:10},itemsizing:"constant"}},{showLink:!1})},t.prototype._getRatio=function(t){let e=0;for(let s=0;s<t.length;s++)e+=t[s].tried;return e/t.length/1e3},t}(),BarSubmissionsPerTasks=function(){function t(t,e){this.course_id=t,this.id_div=e||"submissions_per_task",this.RESOURCE_URL="/api/stats/student/bar_submissions_per_tasks",this.normalize=!1}return t.prototype=Object.create(Statistic.prototype),t.prototype._fetchData=function(){return $.getJSON(this.RESOURCE_URL,{course_id:this.course_id})},t.prototype.toggleNormalize=function(){this.normalize=!this.normalize,this.plotAsync()},t.prototype._plotData=function(t){const e={},s=[];for(let i=0;i<t.length;++i)null==e[t[i].task_name]&&(e[t[i].task_name]=0,s.push(t[i].task_name)),e[t[i].task_name]+=t[i].count;const i=UserStatistics.colors,a=this.createObjectToPlotData(t,e,"COMPILATION_ERROR",i.COMPILATION_ERROR),o=this.createObjectToPlotData(t,e,"TIME_LIMIT_EXCEEDED",i.TIME_LIMIT_EXCEEDED),r=this.createObjectToPlotData(t,e,"MEMORY_LIMIT_EXCEEDED",i.MEMORY_LIMIT_EXCEEDED),n=this.createObjectToPlotData(t,e,"RUNTIME_ERROR",i.RUNTIME_ERROR),c=this.createObjectToPlotData(t,e,"WRONG_ANSWER",i.WRONG_ANSWER),l=this.createObjectToPlotData(t,e,"OUTPUT_LIMIT_EXCEEDED",i.OUTPUT_LIMIT_EXCEEDED),u=this.createObjectToPlotData(t,e,"GRADING_RUNTIME_ERROR",i.GRADING_RUNTIME_ERROR),h=[a,o,r,n,c,l,this.createObjectToPlotData(t,e,"ACCEPTED",i.ACCEPTED),u],d={barmode:"stack",title:"Submissions vs Task",xaxis:{title:"Tasks",categoryorder:"array",categoryarray:s,titlefont:{size:16,color:"rgb(107, 107, 107)"}},yaxis:{title:this.normalize?"Percentage of submissions":"Number of submissions",titlefont:{size:16,color:"rgb(107, 107, 107)"}}};Plotly.purge(this.id_div),Plotly.newPlot(this.id_div,h,d)},t.prototype.createObjectToPlotData=function(t,e,s,i){const a={x:[],y:[],marker:{color:i},name:s,type:"bar"};for(let i=0;i<t.length;++i)t[i].summary_result===s&&(a.x.push(t[i].task_name),this.normalize?a.y.push(t[i].count/e[t[i].task_name]*100):a.y.push(t[i].count));return a},t}();$(function(){UserStatistics.course_id=getCourseId(),UserStatistics.trialsAndBestGradeStatistic=new UserTrialsAndBestGradeStatistic(UserStatistics.course_id),UserStatistics.barSubmissionsPerTasks=new BarSubmissionsPerTasks(UserStatistics.course_id);const t={"trials-circle-tab":UserStatistics.trialsAndBestGradeStatistic,"bar-submissions-per-tasks-tab":UserStatistics.barSubmissionsPerTasks};$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){const s=t[e.target.id];s&&s.plotAsync()}),$('.active > a[data-toggle="tab"]').trigger("shown.bs.tab")});
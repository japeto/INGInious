let studio_grader_test_case_sequence=0,grader_test_cases_count=0,test_cases_input=[],ids_test_cases_input=[];function studio_add_test_case_from_form(){studio_add_test_case({input_file:$("#grader_test_case_in").val(),output_file:$("#grader_test_case_out").val()})}function studio_add_test_case(e){e=$.extend({input_file:null,output_file:null,weight:1,diff_shown:!1},e);let t=studio_grader_test_case_sequence,_=e.input_file,o=e.output_file;if(!_||!o)return;let s=$("#test_case_template").html().replace(/TID/g,t),a=$(s);a.find("#grader_test_cases_"+t+"_input_file").val(_),a.find("#grader_test_cases_"+t+"_output_file").val(o),a.find("#grader_test_cases_"+t+"_weight").val(e.weight),a.find("#grader_test_cases_"+t+"_diff_shown").prop("checked",e.diff_shown),studio_grader_test_case_sequence++,grader_test_cases_count++,test_cases_input.push(_),ids_test_cases_input.push(t),1==grader_test_cases_count&&$("#grader_test_cases_header").show(),$("#grader_test_cases_container").append(a)}function studio_load_grader_test_cases(e){"Notebook"===$("#environment").val()?notebook_grader_load_all_tests(e):$.each(e,function(e,t){studio_add_test_case(t)})}function studio_remove_test_case(e){$("#grader_test_cases_"+e).remove(),0==--grader_test_cases_count&&$("#grader_test_cases_header").hide();let t=ids_test_cases_input.findIndex(t=>t===e);test_cases_input.splice(t,1),ids_test_cases_input.splice(t,1)}function studio_update_grader_problems(){let e=$("#accordion"),t=[];$.each(e.children(),function(e,_){let o=_.id;if(!o.startsWith("subproblem_well_"))throw new Error("Unable to process problem well: "+o);let s=o.substring("subproblem_well_".length),a=$(_).find("[name='problem["+s+"][type]']").val();t.push({id:s,type:a})});let _=$("#grader_problem_id"),o=_.val();_.empty();const s=["code_multiple_languages","code_file_multiple_languages","notebook_file"];$.each(t,function(e,t){-1!==s.indexOf(t.type)&&(_.append($("<option>",{value:t.id,text:t.id})),o=t.id)}),_.val(o)}function studio_set_initial_problem(e){let t=$("#grader_problem_id"),_=e;$("#generate_grader").is(":checked")&&e&&(_=e,t.append($("<option>",{value:e,text:e}))),t.val(_)}function studio_update_grader_files(){"Notebook"!==$("#environment").val()&&$.get("/api/grader_generator/test_file_api",{course_id:courseId,task_id:taskId},function(e){let t=$("#grader_test_case_in"),_=$("#grader_test_case_out"),o=$("#testbench_file_name"),s=$("#hdl_expected_output");t.empty(),_.empty(),o.empty(),s.empty(),$.each(e,function(e,a){if(a.is_directory)return;if("run"===a.complete_name)return;let n=$("<option>",{value:a.complete_name,text:a.complete_name});t.append(n),_.append(n.clone()),o.append(n.clone()),s.append(n.clone())})},"json")}function studio_update_container_name(){const e=$("#environment").val(),t=$(".grader_form");$("#tab_grader").find("div.form-group")[2].style.display="block",$("#tab_grader").find("div.form-group")[3].style.display="block";for(let e=0;e<t.length;e++)t[e].style.display="none";try{switch(e){case"Notebook":$("#notebook_grader_form")[0].style.display="block",$("#tab_grader").find("div.form-group")[2].style.display="none",$("#tab_grader").find("div.form-group")[3].style.display="none";break;case"HDL":$("#hdl_grader_form")[0].style.display="block";break;case"multiple_languages":case"Data Science":$("#multilang_grader_form")[0].style.display="block"}}catch{}}function read_files_and_match(){const e=$("#environment").val();"Notebook"!==e&&"HDL"!==e&&$.get("/api/grader_generator/test_file_api",{course_id:courseId,task_id:taskId},function(e){$.each(e,function(t,_){if(_.is_directory)return;let o={},s=_.name.split("."),a=_.complete_name.split("."),n=s.splice(0,s.length-1).join("."),r=a.splice(0,a.length-1).join(".")+".out";if(!test_cases_input.includes(_.name)&&"in"===s[s.length-1]){let t={level:_.level,complete_name:r,name:n+".out",is_directory:!1};for(ind=0;ind<e.length;ind++){var d=e[ind];d.complete_name===t.complete_name&&d.is_directory===t.is_directory&&studio_add_test_case(o={input_file:_.complete_name,output_file:t.complete_name})}}})},"json")}function toggle_selection_tests_cases(){var e=$("#toggle_select_test_cases")[0].checked;e=!e,$("#toggle_select_test_cases").prop("checked",e),ids_test_cases_input.forEach((t,_)=>{$("#grader_test_cases_"+t+"_diff_shown").prop("checked",e)})}function remove_all_test_cases(){ids_test_cases_input.slice().forEach((e,t)=>{studio_remove_test_case(e)})}let notebook_grader_tests_sequence=0,notebook_grader_tests_cases_count={},editing_test_id=null;const modal_element=$("#notebook_grader_test_form_modal");function toggle_test_case_form_alert(e,t){const _=$("#test_case_alert");_.text(t),e?_.show():_.hide()}function notebook_grader_add_test_case_from_form(){const e=notebook_grader_tests_sequence,t=notebook_grader_create_test_case({code:$("#notebook_grader_test_case_code").val(),expected_output:$("#notebook_grader_test_case_expected_output").val()});t&&(1===notebook_grader_tests_cases_count[e]&&$("#notebook_grader_test_cases_header").show(),$("#notebook_grader_test_cases_container").append(t),codeEditors.notebook_grader_test_case_code.getDoc().setValue(""),$("#notebook_grader_test_case_expected_output").val(""),$(`#${t.attr("id")} .notebook_code`).each(function(e,t){registerCodeEditor(t,$(t).attr("data-x-language"),$(t).attr("data-x-lines"))}))}function notebook_grader_create_test_case(e){if(!(e=$.extend({code:null,expected_output:null},e)).code||!e.expected_output){toggle_test_case_form_alert(!0,"Please complete all the fields to add a test case."),setTimeout(()=>{toggle_test_case_form_alert(!1,"")},6e4)}const t=null!==editing_test_id?editing_test_id:notebook_grader_tests_sequence;notebook_grader_tests_cases_count[t]||(notebook_grader_tests_cases_count[t]=0);const _=notebook_grader_tests_cases_count[t],o=e.code,s=e.expected_output;if(o&&s)return notebook_grader_tests_cases_count[t]++,_notebook_grader_get_test_case_element(t,_,o,s)}function notebook_grader_remove_test_case(e,t){const _=_notebook_grader_shift_test_cases(e,t,"notebook_grader_test_cases_container"),o=$("#notebook_grader_test_cases_container");o.html(""),$.each(_,(e,t)=>{o.append(t);const _=$(`#${t.attr("id")}_code`)[0];registerCodeEditor(_,$(_).attr("data-x-language"),$(_).attr("data-x-lines"))}),notebook_grader_tests_cases_count[e]--,0===notebook_grader_tests_cases_count[e]&&$("#notebook_grader_test_cases_header").hide()}function _notebook_grader_shift_test_cases(e,t){const _=notebook_grader_tests_cases_count[e],o=[];let s=0;for(let a=0;a<_;a++){if(a===t)continue;const _=_notebook_grader_get_test_case_element(e,s,$(`#notebook_grader_test_${e}_cases_${a}_code`).val(),$(`#notebook_grader_test_${e}_cases_${a}_expected_output`).val());o.push(_),s++}return o}function _notebook_grader_get_test_case_element(e,t,_,o){const s=$("#notebook_test_case_template").html().replace(/TID/g,e).replace(/CID/g,t).replace(/case_label/g,t+1),a=$(s);return a.find(`#notebook_grader_test_${e}_cases_${t}_code`).text(_),a.find(`#notebook_grader_test_${e}_cases_${t}_expected_output`).text(o),a}function _notebook_grader_get_test_element(e,t,_){const o=$("#notebook_grader_test_template").html().replace(/TID/g,e),s=t.name,a=t.weight,n=t.setup_code,r=t.show_debug_info,d=$(o);return d.find(`#notebook_grader_test_${e}_name`).val(s),d.find(`#notebook_grader_test_${e}_weight`).val(a),d.find(`#notebook_grader_test_${e}_setup_code`).text(n),d.find(`#notebook_grader_test_${e}_show_debug_info`).prop("checked",r),$.each(_,(t,_)=>{d.find(`#notebook_grader_test_${e}_cases_container`).append(_)}),d}function _notebook_grader_get_test_cases_from_container(e,t){const _=notebook_grader_tests_cases_count[e],o=$(`#${t}`),s=[];for(let t=0;t<_;t++){const _=o.find(`#notebook_grader_test_${e}_cases_${t}`);s.push(_)}return s}function notebook_grader_add_test_from_form(){const e=_notebook_grader_get_test_cases_from_container(notebook_grader_tests_sequence,"notebook_grader_test_cases_container"),t=notebook_grader_create_test({name:$("#notebook_grader_test_name").val(),weight:$("#notebook_grader_test_weight").val(),setup_code:$("#notebook_grader_test_setup_code").val()},e);t&&(1===notebook_grader_tests_sequence&&$("#notebook_grader_tests_header").show(),$("#notebook_grader_tests_container").append(t),modal_element.modal("hide"))}function notebook_grader_create_test(e,t){if(!(e=$.extend({name:"test",weight:1,show_debug_info:!1,setup_code:""},e)).name||!e.weight){return toggle_test_case_form_alert(!0,"Please complete all mandatory fields."),void setTimeout(()=>{toggle_test_case_form_alert(!1,"")},6e4)}const _=notebook_grader_tests_sequence,o=e.name,s=e.weight;if(notebook_grader_tests_cases_count[_]||(notebook_grader_tests_cases_count[_]=0),o&&s&&t.length)return notebook_grader_tests_sequence++,_notebook_grader_get_test_element(_,e,t)}function notebook_grader_load_all_tests(e){$.each(e,function(e,t){const _=[];$.each(t.cases,(e,t)=>{const o=notebook_grader_create_test_case(t);_.push(o)});const o=notebook_grader_create_test(t,_);$("#notebook_grader_tests_header").show(),$("#notebook_grader_tests_container").append(o)})}function notebook_grader_remove_test(e){const t=_notebook_grader_update_tests_ids(e),_=$("#notebook_grader_tests_container");_.html(""),$.each(t,(e,t)=>{_.append(t)}),0===--notebook_grader_tests_sequence&&$("#notebook_grader_tests_header").hide()}function _notebook_grader_update_tests_ids(e){const t=notebook_grader_tests_sequence,_=[];let o=0,s=0;for(;s<t;s++){if(s===e)continue;const t=[],a=notebook_grader_tests_cases_count[s];for(let e=0;e<a;e++){const _=$(`#notebook_grader_test_${s}_cases_${e}_code`).val(),a=$(`#notebook_grader_test_${s}_cases_${e}_expected_output`).val();t.push(_notebook_grader_get_test_case_element(o,e,_,a))}const n={name:$(`#notebook_grader_test_${s}_name`).val(),weight:$(`#notebook_grader_test_${s}_weight`).val(),setup_code:$(`#notebook_grader_test_${s}_setup_code`).val(),show_debug_info:$(`#notebook_grader_test_${s}_show_debug_info`).prop("checked")};_.push(_notebook_grader_get_test_element(o,n,t)),delete notebook_grader_tests_cases_count[s],notebook_grader_tests_cases_count[o]=a,o++}return _}function _notebook_grader_load_test_case_in_modal(e){modal_element.find("#notebook_grader_test_cases_container").append(e),$("#notebook_grader_test_cases_header").show(),$(`#${e.attr("id")} .notebook_code`).each(function(e,t){codeEditors[t.name]||registerCodeEditor(t,$(t).attr("data-x-language"),$(t).attr("data-x-lines"))})}function notebook_grader_on_edit_test(e){editing_test_id=e;const t={name:$(`#notebook_grader_test_${e}_name`).val(),weight:$(`#notebook_grader_test_${e}_weight`).val(),setup_code:$(`#notebook_grader_test_${e}_setup_code`).val()};$("#notebook_grader_test_name").val(t.name),$("#notebook_grader_test_weight").val(t.weight),codeEditors.notebook_grader_test_setup_code.getDoc().setValue(t.setup_code);const _=_notebook_grader_get_test_cases_from_container(e,`notebook_grader_test_${e}`);$.each(_,(e,t)=>{_notebook_grader_load_test_case_in_modal(t)}),modal_element.modal("show")}function notebook_grader_update_test(){const e={name:$("#notebook_grader_test_name").val(),weight:$("#notebook_grader_test_weight").val(),setup_code:$("#notebook_grader_test_setup_code").val()};if(!e.name){return toggle_test_case_form_alert(!0,"Please complete all mandatory fields."),void setTimeout(()=>{toggle_test_case_form_alert(!1,"")},6e4)}const t=editing_test_id,_=e.name,o=e.weight,s=e.setup_code,a=_notebook_grader_get_test_cases_from_container(t,"notebook_grader_test_cases_container");if(!_||!o||!a.length)return;const n=$(`#notebook_grader_test_${t}`);n.find(`#notebook_grader_test_${t}_name`).val(_),n.find(`#notebook_grader_test_${t}_weight`).val(o),n.find(`#notebook_grader_test_${t}_setup_code`).text(s),n.find(`#notebook_grader_test_${t}_cases_container`).html(""),$.each(a,(e,_)=>{n.find(`#notebook_grader_test_${t}_cases_container`).append(_)}),modal_element.modal("hide"),editing_test_id=null}function _clear_modal(){$("#notebook_grader_test_form_modal input").val(""),$("#notebook_grader_test_form_modal textarea").val(""),$("#notebook_grader_test_cases_header").hide(),$("#notebook_grader_test_cases_container").html("");$("#notebook_grader_test_form_modal .CodeMirror").each(function(e,t){t.CodeMirror.getDoc().setValue("")})}$(".notebook_grader_submit_test_form").click(e=>{e.preventDefault(),null!==editing_test_id?notebook_grader_update_test():notebook_grader_add_test_from_form()}),modal_element.on("hidden.bs.modal",()=>{null!==editing_test_id&&notebook_grader_update_test(),_clear_modal()}),modal_element.on("shown.bs.modal",()=>{$("#notebook_grader_test_form_modal .CodeMirror").each(function(e,t){t.CodeMirror.refresh()})});
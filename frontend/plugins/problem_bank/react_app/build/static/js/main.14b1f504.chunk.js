(this.webpackJsonpUNCode_problem_bank=this.webpackJsonpUNCode_problem_bank||[]).push([[0],{104:function(e,t,a){e.exports=a(209)},209:function(e,t,a){"use strict";a.r(t);var s=a(1),l=a.n(s),n=a(11),r=a.n(n),i=(a(58),a(12)),o=a(13),c=a(10),u=a(15),p=a(14),d=a(9),h=a(30),m={[h.ITEM_TYPES.PAGE]:function(e){var t=e.value,a=e.isActive,s=e.onClick;return l.a.createElement("li",{className:a?"active":null},l.a.createElement("a",{href:"#",onClick:s},t))},[h.ITEM_TYPES.ELLIPSIS]:function(e){var t=e.onClick;return l.a.createElement("li",null,l.a.createElement("a",{href:"#",onClick:t},"..."))},[h.ITEM_TYPES.FIRST_PAGE_LINK]:function(e){e.isActive;var t=e.onClick;return l.a.createElement("li",null,l.a.createElement("a",{href:"#",onClick:t},"\xab"))},[h.ITEM_TYPES.PREVIOUS_PAGE_LINK]:function(e){e.isActive;var t=e.onClick;return l.a.createElement("li",null,l.a.createElement("a",{href:"#",onClick:t},"\u2039"))},[h.ITEM_TYPES.NEXT_PAGE_LINK]:function(e){e.isActive;var t=e.onClick;return l.a.createElement("li",null,l.a.createElement("a",{href:"#",onClick:t},"\u203a"))},[h.ITEM_TYPES.LAST_PAGE_LINK]:function(e){e.isActive;var t=e.onClick;return l.a.createElement("li",null,l.a.createElement("a",{href:"#",onClick:t},"\xbb"))}},b=Object(h.createUltimatePagination)({itemTypeToComponent:m,WrapperComponent:function(e){var t=e.children;return l.a.createElement("ul",{className:"pagination custom-pagination"},t)}}),k=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e,s){var l;return Object(i.a)(this,a),(l=t.call(this,e,s)).state={showModal:!1},l.open=l.open.bind(Object(c.a)(l)),l.close=l.close.bind(Object(c.a)(l)),l.onDeleteCourse=l.onDeleteCourse.bind(Object(c.a)(l)),l}return Object(o.a)(a,[{key:"open",value:function(){this.setState({showModal:!0})}},{key:"close",value:function(){this.setState({showModal:!1})}},{key:"onDeleteCourse",value:function(){var e=this.props.id;(0,this.props.callbackOnDeleteCourse)(e),this.close()}},{key:"render",value:function(){return this.props.removable?l.a.createElement("div",null,l.a.createElement("a",{className:"list-group-item"},l.a.createElement("b",null,this.props.name),l.a.createElement("span",{role:"button",className:"glyphicon glyphicon-remove pull-right text-danger",onClick:this.open})),l.a.createElement(d.e,{className:"modal-container",show:this.state.showModal,onHide:this.close,animation:!0,bsSize:"large"},l.a.createElement(d.e.Header,{closeButton:!0},l.a.createElement(d.e.Title,null," ",this.props.name," ")),l.a.createElement(d.e.Body,null,l.a.createElement(d.a,{bsStyle:"warning"},l.a.createElement("h5",null,l.a.createElement("strong",null,"Are you sure that you want to remove the bank privileges from this course?")),l.a.createElement("h6",null,"* The course won't be removed, only the permits to be a bank will be removed."))),l.a.createElement(d.e.Footer,null,l.a.createElement(d.b,{onClick:this.close},"Cancel"),l.a.createElement(d.b,{onClick:this.onDeleteCourse,bsStyle:"primary"},"Remove")))):l.a.createElement("div",null,l.a.createElement("a",{className:"list-group-item"},l.a.createElement("b",null,this.props.name)))}}]),a}(l.a.Component),C=a(102),g=a.n(C),A=a(103),v=a.n(A),y=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).getSuggestions=function(e){var t=e.toUpperCase();return s.props.courses.filter((function(e){return e.name.toUpperCase().startsWith(t)||e.id.toUpperCase().startsWith(t)}))},s.renderSuggestion=function(e,t){t.query,t.isHighlighted;return l.a.createElement("span",null,e.name)},s.onChange=function(e,t){var a=t.newValue;s.setState({value:a})},s.onConfirm=function(){var e="";s.state.selectedCourse.name.toUpperCase()===s.state.value.toUpperCase()&&(e=s.state.selectedCourse.id),(0,s.props.callbackOnClick)(e),s.setState({value:"",selectedCourse:{id:"",name:""},show:!1})},s.getSuggestionValue=function(e){return s.setState({selectedCourse:e}),e.name},s.state={suggestions:[],value:"",selectedCourse:{id:"",name:""},show:!1},s.open=s.open.bind(Object(c.a)(s)),s.close=s.close.bind(Object(c.a)(s)),s}return Object(o.a)(a,[{key:"open",value:function(){this.setState({show:!0})}},{key:"close",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this,t={placeholder:"Type a course name or course id",value:this.state.value,onChange:this.onChange};return l.a.createElement(d.f,null,l.a.createElement(d.c,{md:this.props.mdInput},l.a.createElement(g.a,{suggestions:this.state.suggestions,onSuggestionsFetchRequested:function(t){var a=t.value;return e.setState({suggestions:e.getSuggestions(a)})},onSuggestionsClearRequested:function(){return e.setState({suggestions:[]})},getSuggestionValue:this.getSuggestionValue,renderSuggestion:this.renderSuggestion,inputProps:t})),l.a.createElement(d.c,{md:this.props.mdButton},l.a.createElement("button",{onClick:this.open,className:"btn btn-primary",disabled:!this.state.value},this.props.messageButton)),l.a.createElement(v.a,{warning:!0,showCancel:!0,confirmBtnText:"Yes!",confirmBtnBsStyle:"warning",cancelBtnBsStyle:"danger",show:this.state.show,title:this.props.alertTitle,onConfirm:this.onConfirm,onCancel:this.close},this.props.alertText),l.a.createElement(d.c,{mdHidden:6}))}}]),a}(l.a.Component),f=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).timer=0,s.handleDelayedDismiss=s.handleDelayedDismiss.bind(Object(c.a)(s)),s.handleAlertDismiss=s.handleAlertDismiss.bind(Object(c.a)(s)),s}return Object(o.a)(a,[{key:"handleAlertDismiss",value:function(){clearTimeout(this.timer),(0,this.props.callbackParent)(!1),this.forceUpdate()}},{key:"handleDelayedDismiss",value:function(){this.timer=setTimeout(this.props.callbackSetAlertInvisible,1e4)}},{key:"render",value:function(){return this.props.isVisible?(clearTimeout(this.timer),this.handleDelayedDismiss(),l.a.createElement(d.a,{bsStyle:this.props.styleAlert,onDismiss:this.handleAlertDismiss},l.a.createElement("h4",null,this.props.titleAlert),l.a.createElement("p",null,this.props.message))):l.a.createElement("p",null)}}]),a}(l.a.Component),E=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(i.a)(this,a);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).getListOfCourses=function(){var t=e.props.courses.map((function(t,a){var s=e.props.page,n=e.props.limit;if(a>=(s-1)*n&&a<s*n)return l.a.createElement(k,{name:t.name,removable:t.is_removable,id:t.id,key:a,callbackOnDeleteCourse:e.props.callbackOnDeleteCourse})}));return t.length||(t="There are no available courses"),t},e.getListOfAvailableCourses=function(){var t=e.props.availableCourses.map((function(t,a){var s=e.props.pageAvailableCourses,n=e.props.limit;if(a>=(s-1)*n&&a<s*n)return l.a.createElement(k,{name:t.name,removable:!1,id:t.id,key:a,callbackOnDeleteCourse:e.props.callbackOnDeleteCourse})}));return t.length||(t="There are no available courses"),t},e}return Object(o.a)(a,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(f,{message:this.props.dataAlert.data.message,isVisible:this.props.dataAlert.isVisibleAlert,callbackParent:this.props.callbackOnChildChangedClose,styleAlert:this.props.dataAlert.styleAlert,titleAlert:this.props.dataAlert.titleAlert,callbackSetAlertInvisible:this.props.callbackSetAlertInvisible}),l.a.createElement(d.i,{bsSize:"small"},l.a.createElement("h5",null,"Select course to become in bank"),l.a.createElement(y,{courses:this.props.availableCourses,alertTitle:"Are you sure you want to add this course to the bank?",alertText:"* The course and tasks from this course will be public and every user could copy",callbackOnClick:this.props.callbackAddCourse,messageButton:"Add course to bank",mdInput:4,mdButton:2})),l.a.createElement(d.f,null,l.a.createElement(d.c,{md:6},l.a.createElement("div",null,"The following courses are marked as task sources:",l.a.createElement("br",null),l.a.createElement("small",null," (You are free to copy the tasks from these courses)")),l.a.createElement("div",{className:"list-group"},this.getListOfCourses()),l.a.createElement(b,{currentPage:this.props.page,totalPages:this.props.totalPages,onChange:this.props.callbackOnPageChange})),l.a.createElement(d.c,{md:6},l.a.createElement("div",null,"The following courses are not marked as bank and you are admin:",l.a.createElement("br",null),l.a.createElement("small",null," (You can copy tasks from these courses to other courses which you are admin)")),l.a.createElement("div",{className:"list-group"},this.getListOfAvailableCourses()),l.a.createElement(b,{currentPage:this.props.pageAvailableCourses,totalPages:this.props.totalAvailableCoursePages,onChange:this.props.callbackOnPageAvailableCourseChange}))))}}]),a}(l.a.Component),T=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e,s){var l;return Object(i.a)(this,a),(l=t.call(this,e,s)).state={showModal:!1},l.onClick=l.onClick.bind(Object(c.a)(l)),l.close=l.close.bind(Object(c.a)(l)),l.open=l.open.bind(Object(c.a)(l)),l}return Object(o.a)(a,[{key:"open",value:function(){this.setState({showModal:!0})}},{key:"close",value:function(){this.setState({showModal:!1})}},{key:"onClick",value:function(e){var t=this.props.task_info.task_id,a=this.props.task_info.course_id;(0,this.props.callBackAddTaskToCourse)(e,t,a),this.close()}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("button",{className:"list-group-item",onClick:this.open},l.a.createElement("b",null,this.props.task_info.course_name+" - "+this.props.task_info.task_name),l.a.createElement("br",null),this.props.task_info.tags.join(", ")),l.a.createElement(d.e,{className:"modal-container",show:this.state.showModal,onHide:this.close,animation:!0,bsSize:"large"},l.a.createElement(d.e.Header,{closeButton:!0},l.a.createElement(d.e.Title,{componentClass:"h3",bsClass:"new-modal-title"}," ",this.props.task_info.task_name," ")),l.a.createElement(d.e.Body,null,l.a.createElement(d.f,null,l.a.createElement(d.c,{md:1},l.a.createElement("h5",null,"Course:")),l.a.createElement(d.c,{md:11},l.a.createElement(d.i,{bsSize:"small"},this.props.task_info.course_name))),l.a.createElement(d.f,null,l.a.createElement(d.c,{md:1},l.a.createElement("h5",null,"Author:")),l.a.createElement(d.c,{md:11},l.a.createElement(d.i,{bsSize:"small"},this.props.task_info.task_author))),l.a.createElement(d.f,null,l.a.createElement(d.c,{md:1},l.a.createElement("h5",null,"Context:")),l.a.createElement(d.c,{md:11},l.a.createElement(d.i,{bsSize:"small",dangerouslySetInnerHTML:{__html:this.props.task_info.task_context}}))),l.a.createElement(d.i,{bsSize:"small"},l.a.createElement("h5",null,"Select destination course"),l.a.createElement(y,{task_info:this.props.task_info,courses:this.props.courses,alertTitle:"Do you want to add the task '"+this.props.task_info.task_name+"' to the selected course?",alertText:"",messageButton:"Copy task",callbackOnClick:this.onClick,mdInput:4,mdButton:4}))),l.a.createElement(d.e.Footer,null,l.a.createElement(d.b,{onClick:this.close},"Close"))))}}]),a}(l.a.Component),O=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).onChangePage=function(e){console.log(s.state.query),""===s.state.query?s.props.callbackUpdateTasks(e):s.props.callbackUpdateFilteredTasks(s.state.query,e)},s.addTaskToCourse=function(e,t,a){s.props.callBackAddTaskToCourse(e,t,a,s.state.query)},s.getListOfTasks=function(){var e=s.props.tasks.map((function(e,t){return l.a.createElement(T,{task_info:e,key:t,courses:s.props.courses,callBackAddTaskToCourse:s.addTaskToCourse})}));return e.length||(e="There are no tasks available."),e},s.state={query:"",timer:0},s.handleChange=s.handleChange.bind(Object(c.a)(s)),s}return Object(o.a)(a,[{key:"handleChange",value:function(e){var t=e.target.value,a=this.props.callbackUpdateFilteredTasks;clearTimeout(this.state.timer),""===t?(this.props.callbackUpdateTasks(),this.setState({query:t,timer:0})):this.setState({query:t,timer:setTimeout((function(){return a(t)}),500)})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(f,{message:this.props.dataAlert.data.message,isVisible:this.props.dataAlert.isVisibleAlert,callbackParent:this.props.callbackOnChildChangedClose,styleAlert:this.props.dataAlert.styleAlert,titleAlert:this.props.dataAlert.titleAlert,callbackSetAlertInvisible:this.props.callbackSetAlertInvisible}),l.a.createElement("form",{className:"custom-search-input"},l.a.createElement("h5",null,"Search tasks:"),l.a.createElement(d.d,{type:"text",value:this.props.query,placeholder:"Type a course id or name, task name or a tag",onChange:this.handleChange})),l.a.createElement("div",null,"The following tasks are available for copying:"),l.a.createElement("div",{className:"list-group"},this.getListOfTasks()),l.a.createElement(b,{currentPage:this.props.page,totalPages:this.props.totalPages,onChange:this.onChangePage}))}}]),a}(l.a.Component),S=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(i.a)(this,a),(s=t.call(this,e)).state={tasks:[],courses:[],availableCourses:[],availableCoursesToCopy:[],pageTasks:1,pageCourses:1,pageAvailableCourses:1,totalPagesTasks:1,totalPagesCourses:1,totalPagesAvailableCourses:1,dataAlertCourseList:{data:{message:""},isVisibleAlert:!1,titleAlert:"",styleAlert:""},dataAlertTaskList:{data:{message:""},isVisibleAlert:!1,titleAlert:"",styleAlert:""}},s.tasksQuery="",s.limit=10,s.onPageCourseChange=s.onPageCourseChange.bind(Object(c.a)(s)),s.addTaskToCourse=s.addTaskToCourse.bind(Object(c.a)(s)),s.updateBankCoursesAsync=s.updateBankCoursesAsync.bind(Object(c.a)(s)),s.updateTasksAsync=s.updateTasksAsync.bind(Object(c.a)(s)),s.updateAvailableCoursesAsync=s.updateAvailableCoursesAsync.bind(Object(c.a)(s)),s.updateAvailableCoursesToCopyAsync=s.updateAvailableCoursesToCopyAsync.bind(Object(c.a)(s)),s.deleteCourse=s.deleteCourse.bind(Object(c.a)(s)),s.updateFilteredTasksAsync=s.updateFilteredTasksAsync.bind(Object(c.a)(s)),s.addCourse=s.addCourse.bind(Object(c.a)(s)),s.onAlertTaskListClose=s.onAlertTaskListClose.bind(Object(c.a)(s)),s.onAlertCourseListClose=s.onAlertCourseListClose.bind(Object(c.a)(s)),s.setAlertCourseListInvisible=s.setAlertCourseListInvisible.bind(Object(c.a)(s)),s.setAlertTaskListInvisible=s.setAlertTaskListInvisible.bind(Object(c.a)(s)),s.onPageAvailableCourseChange=s.onPageAvailableCourseChange.bind(Object(c.a)(s)),s}return Object(o.a)(a,[{key:"updateBankCoursesAsync",value:function(){var e=this;$.getJSON("/plugins/problems_bank/api/bank_courses").then((function(t){var a=t,s=Math.ceil(a.length/e.limit);0===s&&(s=1),e.setState({totalPagesCourses:s,pageCourses:1,courses:a})}))}},{key:"updateTasksAsync",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a="/plugins/problems_bank/api/bank_tasks?limit=".concat(this.limit,"&page=").concat(t);$.getJSON(a).then((function(a){var s=a.total_pages;e.setState({totalPagesTasks:s,pageTasks:t,tasks:a.tasks})}))}},{key:"updateAvailableCoursesAsync",value:function(){var e=this;$.getJSON("/plugins/problems_bank/api/available_courses").then((function(t){var a=t,s=Math.ceil(a.length/e.limit);0===s&&(s=1),e.setState({totalPagesAvailableCourses:s,pageAvailableCourses:1,availableCourses:t})}))}},{key:"updateAvailableCoursesToCopyAsync",value:function(){var e=this;$.getJSON("/plugins/problems_bank/api/available_courses_to_copy").then((function(t){e.setState({availableCoursesToCopy:t})}))}},{key:"deleteCourse",value:function(e){var t=this;$.ajax({url:"/plugins/problems_bank/api/bank_courses?"+$.param({course_id:e}),type:"DELETE",success:function(e){t.updateBankCoursesAsync(),t.updateAvailableCoursesAsync(),""===t.tasksQuery?t.updateTasksAsync():t.updateFilteredTasksAsync(t.tasksQuery)}}).done((function(e){t.setState({dataAlertCourseList:{data:e,isVisibleAlert:!0,titleAlert:"Success!",styleAlert:"success"}})})).error((function(e){t.setState({dataAlertCourseList:{isVisibleAlert:!0,data:{message:e.responseJSON.error},titleAlert:"Error!",styleAlert:"danger"}})}))}},{key:"updateFilteredTasksAsync",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s={task_query:e,limit:this.limit,page:a};this.tasksQuery=e,$.post("/plugins/problems_bank/api/filter_bank_tasks",s,(function(e){var s=e.total_pages,l=e.tasks;t.setState({tasks:l,pageTasks:a,totalPagesTasks:s})}))}},{key:"addCourse",value:function(e){var t=this;$.post("/plugins/problems_bank/api/bank_courses",{course_id:e},(function(e){t.updateBankCoursesAsync(),t.updateAvailableCoursesAsync(),""===t.tasksQuery?t.updateTasksAsync():t.updateFilteredTasksAsync(t.tasksQuery)})).done((function(e){t.setState({dataAlertCourseList:{data:e,isVisibleAlert:!0,titleAlert:"Success!",styleAlert:"success"}})})).error((function(e){t.setState({dataAlertCourseList:{isVisibleAlert:!0,data:{message:e.responseJSON.error},titleAlert:"Error!",styleAlert:"danger"}})}))}},{key:"onAlertTaskListClose",value:function(e){this.setState({dataAlertTaskList:{isVisibleAlert:e,data:{message:""},titleAlert:"",styleAlert:""}})}},{key:"onAlertCourseListClose",value:function(e){this.setState({dataAlertCourseList:{isVisibleAlert:e,data:{message:""},titleAlert:"",styleAlert:""}})}},{key:"addTaskToCourse",value:function(e,t,a,s){var l=this,n={target_id:e,task_id:t,bank_id:a};$.post("/plugins/problems_bank/api/copy_task",n,(function(e){""===s?l.updateTasksAsync():l.updateFilteredTasksAsync(s)})).done((function(e){l.setState({dataAlertTaskList:{data:e,isVisibleAlert:!0,titleAlert:"Success!",styleAlert:"success"}})})).error((function(e){l.setState({dataAlertTaskList:{isVisibleAlert:!0,data:{message:e.responseJSON.error},titleAlert:"Error!",styleAlert:"danger"}})}))}},{key:"setAlertCourseListInvisible",value:function(){this.setState({dataAlertCourseList:{data:{message:""},isVisibleAlert:!1,titleAlert:"",styleAlert:""}})}},{key:"setAlertTaskListInvisible",value:function(){this.setState({dataAlertTaskList:{data:{message:""},isVisibleAlert:!1,titleAlert:"",styleAlert:""}})}},{key:"onPageCourseChange",value:function(e){this.setState({pageCourses:e})}},{key:"onPageAvailableCourseChange",value:function(e){this.setState({pageAvailableCourses:e})}},{key:"componentWillMount",value:function(){this.updateBankCoursesAsync(),this.updateAvailableCoursesAsync(),this.updateAvailableCoursesToCopyAsync(),this.updateTasksAsync()}},{key:"render",value:function(){return l.a.createElement(d.h,{defaultActiveKey:1,id:"bank-page-tabs"},l.a.createElement(d.g,{eventKey:1,title:"Courses"},l.a.createElement(E,{limit:this.limit,courses:this.state.courses,availableCourses:this.state.availableCourses,page:this.state.pageCourses,totalPages:this.state.totalPagesCourses,pageAvailableCourses:this.state.pageAvailableCourses,totalAvailableCoursePages:this.state.totalPagesAvailableCourses,dataAlert:this.state.dataAlertCourseList,callbackOnChildChangedClose:this.onAlertCourseListClose,callbackUpdateTask:this.updateTasksAsync,callbackUpdateBank:this.updateBankCoursesAsync,callbackUpdateAvailable:this.updateAvailableCoursesAsync,callbackOnPageChange:this.onPageCourseChange,callbackOnPageAvailableCourseChange:this.onPageAvailableCourseChange,callbackOnDeleteCourse:this.deleteCourse,callbackAddCourse:this.addCourse,callbackSetAlertInvisible:this.setAlertCourseListInvisible})),l.a.createElement(d.g,{eventKey:2,title:"Tasks"},l.a.createElement(O,{tasks:this.state.tasks,limit:this.limit,page:this.state.pageTasks,totalPages:this.state.totalPagesTasks,courses:this.state.availableCoursesToCopy,dataAlert:this.state.dataAlertTaskList,callbackOnChildChangedClose:this.onAlertTaskListClose,callbackUpdateTasks:this.updateTasksAsync,callbackUpdateFilteredTasks:this.updateFilteredTasksAsync,callBackAddTaskToCourse:this.addTaskToCourse,callbackSetAlertInvisible:this.setAlertTaskListInvisible})))}}]),a}(l.a.Component);r.a.render(l.a.createElement(S,null),document.getElementById("reactRoot"))},58:function(e,t,a){}},[[104,1,2]]]);
//# sourceMappingURL=main.14b1f504.chunk.js.map
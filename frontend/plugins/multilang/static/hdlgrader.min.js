function updateWaveDromBlock(e,s){$("#"+e).html(parseOutputDiff(s)+parseHDL(s)),WaveDrom.ProcessAll()}function parseHDL(e){let s=e.split("\n"),a={},t={},p={},i={},r={},n={},l={},u=[],f=0,h=0;u.push('<script type="WaveDrom">'),u.push("{signal: [");for(let e=0;e<s.length;++e){let u=s[e],o=u.replace(/ /g,"").split(","),c=null,d=parseInt(o[1]);if(u.startsWith("---"))c='<span class="diff-missing-output">'+u.substring(4)+"</span>";else if(u.startsWith("+++"))c='<span class="diff-additional-output">'+u.substring(4)+"</span>";else if(u.startsWith("@@"))c='<span class="diff-position-control">'+u+"</span>";else if(u.startsWith("-")){let e=!1,s=!1;if(o.length>2){let p=2;for(;p<o.length;){if("INPUTS"===o[p])e=!0,s=!1;else if("OUTPUTS"===o[p])e=!1,s=!0;else{let i=o[p],l=o[p+1];e?(0==d?i.includes("[")?(r[i]=1,n[i]=[],a[i]="2",n[i].push("'"+l+"'")):a[i]=l:i in r?n[i].slice(-1)=="'"+l+"'"?a[i]+=".".repeat(d-f):(a[i]+=".".repeat(d-f-1)+"2",n[i].push("'"+l+"'")):a[i].replace(/\./g,"").slice(-1)===l?a[i]+=".".repeat(d-f):a[i]+=".".repeat(d-f-1)+l,p++):s&&(0==d?i.includes("[")?(r[i]=1,n[i]=[],t[i]="2",n[i].push("'"+l+"'")):t[i]=l:i in r?n[i].slice(-1)=="'"+l+"'"?t[i]+=".".repeat(d-f):(t[i]+=".".repeat(d-f-1)+"2",n[i].push("'"+l+"'")):t[i].replace(/\./g,"").slice(-1)===l?t[i]+=".".repeat(d-f):t[i]+=".".repeat(d-f-1)+l,p++)}p++}f=d}c='<span class="diff-missing-output">'+u.substring(1)+"</span>"}else if(u.startsWith("+")){let e=!1,s=!1;if(o.length>2){let a=2;for(;a<o.length;){if("INPUTS"===o[a])e=!0,s=!1;else if("OUTPUTS"===o[a])e=!1,s=!0;else{let t=o[a],n=o[a+1];e?(0==d?t.includes("[")?(r[t]=1,l[t]=[],p[t]="2",l[t].push("'"+n+"'")):p[t]=n:t in r?l[t].slice(-1)=="'"+n+"'"?p[t]+=".".repeat(d-h):(p[t]+=".".repeat(d-h-1)+"2",l[t].push("'"+n+"'")):p[t].replace(/\./g,"").slice(-1)===n?p[t]+=".".repeat(d-h):p[t]+=".".repeat(d-h-1)+n,a++):s&&(0==d?t.includes("[")?(r[t]=1,l[t]=[],i[t]="2",l[t].push("'"+n+"'")):i[t]=n:t in r?l[t].slice(-1)=="'"+n+"'"?i[t]+=".".repeat(d-h):(i[t]+=".".repeat(d-h-1)+"2",l[t].push("'"+n+"'")):i[t].replace(/\./g,"").slice(-1)===n?i[t]+=".".repeat(d-h):i[t]+=".".repeat(d-h-1)+n,a++)}a++}h=d}c='<span class="diff-additional-output">'+u.substring(1)+"</span>"}else if(u.startsWith(" ")){let e=!1,s=!1;if(o.length>2){let u=2;for(;u<o.length;){if("INPUTS"===o[u])e=!0,s=!1;else if("OUTPUTS"===o[u])e=!1,s=!0;else{let c=o[u],g=o[u+1];e?(0==d?c.includes("[")?(r[c]=1,l[c]=[],p[c]="2",l[c].push("'"+g+"'"),n[c]=[],a[c]="2",n[c].push("'"+g+"'")):(p[c]=g,a[c]=g):c in r?(n[c].slice(-1)=="'"+g+"'"?a[c]+=".".repeat(d-f):(a[c]+=".".repeat(d-f-1)+"2",n[c].push("'"+g+"'")),l[c].slice(-1)=="'"+g+"'"?p[c]+=".".repeat(d-h):(p[c]+=".".repeat(d-h-1)+"2",l[c].push("'"+g+"'"))):(a[c].replace(/\./g,"").slice(-1)===g?a[c]+=".".repeat(d-f):a[c]+=".".repeat(d-f-1)+g,p[c].replace(/\./g,"").slice(-1)===g?p[c]+=".".repeat(d-h):p[c]+=".".repeat(d-h-1)+g),u++):s&&(0==d?c.includes("[")?(r[c]=1,l[c]=[],i[c]="2",l[c].push("'"+g+"'"),n[c]=[],t[c]="2",n[c].push("'"+g+"'")):(i[c]=g,t[c]=g):c in r?(l[c].slice(-1)=="'"+g+"'"?i[c]+=".".repeat(d-h):(i[c]+=".".repeat(d-h-1)+"2",l[c].push("'"+g+"'")),n[c].slice(-1)=="'"+g+"'"?t[c]+=".".repeat(d-f):(t[c]+=".".repeat(d-f-1)+"2",n[c].push("'"+g+"'"))):(t[c].replace(/\./g,"").slice(-1)===g?t[c]+=".".repeat(d-f):t[c]+=".".repeat(d-f-1)+g,i[c].replace(/\./g,"").slice(-1)===g?i[c]+=".".repeat(d-h):i[c]+=".".repeat(d-h-1)+g),u++)}u++}f=d,h=d}}else u.startsWith("...")?c='<span class="diff-position-control">'+u+"</span>":""===u&&(c=u)}u.push('{name:"Inputs:"},');let o=65;for(var c in p)c in r?p[c]===a[c]&&l[c]===n[c]?u.push('{name:"'+c+'", wave: "'+a[c]+'", data:['+n[c]+"]},"):(dataDiff=parseDiffWaveDromBus(p[c],a[c],l[c],n[c]),u.push('{name:"'+c+'", '+dataDiff+"},"),u.push('{name:"'+c+'*", wave: "'+a[c]+'", data:['+n[c]+"]},")):p[c]===a[c]?u.push('{name:"'+c+'", wave: "'+p[c]+'"},'):(nodes=parseDiffWaveDrom(p[c],a[c],o),u.push('{name:"'+c+'", wave: "'+p[c]+'", node:"'+nodes+'"},'),u.push('{name:"'+c+'*", wave: "'+a[c]+'"},'),o+=nodes.length-(nodes.match(/\./g)||[]).length);for(var c in u.push('{name:"Outputs:"},'),i)c in r?i[c]===t[c]&&JSON.stringify(l[c])==JSON.stringify(n[c])?u.push('{name:"'+c+'", wave: "'+t[c]+'", data:['+n[c]+"]},"):(dataDiff=parseDiffWaveDromBus(i[c],t[c],l[c],n[c]),u.push('{name:"'+c+'", '+dataDiff+"},"),u.push('{name:"'+c+'*", wave: "'+t[c]+'", data:['+n[c]+"]},")):i[c]===t[c]?u.push('{name:"'+c+'", wave: "'+t[c]+'"},'):(nodes=parseDiffWaveDrom(i[c],t[c],o),u.push('{name:"'+c+'", wave: "'+i[c]+'", node:"'+nodes+'"},'),u.push('{name:"'+c+'*", wave: "'+t[c]+'"},'),o+=nodes.length-(nodes.match(/\./g)||[]).length);if(u.push("]"),65!=o){u.push(',"edge":['),edges=[];for(let e=65;e<o;e+=2)edges.push("'"+String.fromCharCode(e)+"|-|"+String.fromCharCode(e+1)+" diff'");u.push(edges.join(", ")),u.push("]")}return u.push("}"),u.push("<\/script>"),u.join("\n")}function parseDiffWaveDrom(e,s,a){let t="",p="",i="",r=!1;for(let n=0;n<e.length;n++)"."!==e[n]&&(p=e[n]),"."!==s[n]&&(i=s[n]),p!==i?r?t+=".":(t+=String.fromCharCode(a),a+=1,r=!0):r?(t+=String.fromCharCode(a),a+=1,r=!1):t+=".";return r&&(t+=String.fromCharCode(a)),t}function parseDiffWaveDromBus(e,s,a,t){let p="",i=[],r="",n="",l=!1,u=!1,f=0,h=0;for(let o=0;o<e.length;o++)"."!==e[o]&&(r=a[f],f++),"."!==s[o]&&(n=t[h],h++),r!=n?(l=!1,r!=i.slice(-1)&&(u=!1),u?p+=".":(u=!0,p+="9",i.push(r))):(u=!1,r!=i.slice(-1)&&(l=!1),l?p+=".":(l=!0,p+="2",i.push(r)));return'wave: "'+p+'", data:['+i+"]"}